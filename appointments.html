<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Cita - Dra. Corniel</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Poppins:wght@300;600&display=swap"
        rel="stylesheet">

    <style>
        /* Estilos generales */
        body {
            font-family: 'Poppins', sans-serif;
            color: #333;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
           
        }

        header {
            background-color: #343a40; 
            padding: 20px 0;
            border-bottom: 1px solid #e0e0e0;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            color: #ffffff;
            font-size: 1.8em;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
        }

        nav ul li {
            margin-left: 30px;
            position: relative;
        }

        nav ul li a {
            text-decoration: none;
            color: #ffffff;
            font-weight: 600;
            padding: 10px;
            transition: color 0.3s ease;
            position: relative;
            display: block;
        }

        nav ul li a:hover {
            color: #007f91;
        }

        nav ul li a::before {
            content: "";
            position: absolute;
            width: 0%;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: #007f91;
            transition: width 0.3s ease;
        }

        nav ul li a:hover::before {
            width: 100%;
        }

        /* Botón de menú para móviles */
        .menu-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
        }

        .menu-toggle span {
            height: 3px;
            background-color: #ffffff;
            margin: 5px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        /* Animaciones del botón de menú */
        .menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }

        .menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -5px);
        }

        @media (max-width: 768px) {
            nav ul {
                position: absolute;
                top: 100%;
                left: -100%;
                flex-direction: column;
                background-color: #ffffff;
                width: 100%;
                padding: 20px;
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
                border-radius: 10px;
                transition: left 0.3s ease;
            }

            nav ul li {
                margin-left: 0;
                margin-bottom: 10px;
            }

            nav ul li a {
                font-size: 1.2em;
            }

            .menu-toggle {
                display: flex;
            }

            nav ul.active {
                left: 0;
            }
        }

        /* Sección Mi Cita */
        .appointment-section {
            padding: 60px 0;
            text-align: center;
        }

        .appointment-section h2 {
            font-size: 2.5em;
            color: #343a40;
            margin-bottom: 40px;
        }

        .widget {
            position: relative;
            margin-bottom: 20px;
            text-align: left;
            background-color: #ffffff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            font-size: 1.1em;
            color: #333;
        }

        .widget input,
        .widget select {
            width: 95%;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
            font-family: 'Poppins', sans-serif;
            font-size: 1em;
            background-color: #f8f9fa;
            margin-bottom: 20px;
            color: #333;
            border-color: blue;
        }

        .button-container {
            margin-bottom: 30px;
        }

        .zoom-button {
            background-color: #007f91;
            color: #ffffff;
            padding: 15px 20px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-family: 'Poppins', sans-serif;
            font-size: 1.2em;
            text-decoration: none;
        }

        .zoom-button:hover {
            background-color: #005f73;
        }

        .details-section {
            text-align: left;
            margin-bottom: 30px;
        }

        /*tamaño del texto */
        .details-section h3 {   
            font-size: 1.8em;
            color: #343a40;
            margin-bottom: 20px;
        }

        .info-section {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 15px rgba(0, 0, 0, 0.1);
            text-align: left;
        }

        .info-section h3 {
            font-size: 1.5em;
            color: #343a40;
            margin-bottom: 20px;
        }

        .info-section p {
            color: #555;
            line-height: 1.6;
        }

        .info-section a {
            color: #007f91;
            text-decoration: none;
        }

        footer {
            background-color: #343a40;
            padding: 20px 0;
            border-top: 1px solid #e0e0e0;
            margin-top: 40px;
        }

        footer .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #ffffff;
        }

        footer nav ul {
            display: flex;
        }

        footer nav ul li {
            margin-left: 20px;
        }

        footer nav ul li a {
            color: #ffffff;
        }
    </style>
</head>

<body>

    <!-- Encabezado con navegación -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">Dra. Corniel</div>
                <div class="menu-toggle" id="menu-toggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <ul id="nav-menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="services.html">Servicios</a></li>
                    <li><a href="about.html">Sobre Mí</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="contact.html">Contacto</a></li>
                    <li><a href="appointments.html" class="zoom-button">Agendar cita</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Sección Mi Cita -->
    <section class="appointment-section">
        <div class="container">
            <h2>Agendar</h2>

            <!-- Detalles de la Cita -->
            <div class="details-section">
                <h3>Complete el siguiente formulario.</h3>
                <div class="widget">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" placeholder="Nombre" required />
                </div>
                <div class="widget">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" required />
                </div>
                <div class="widget">
                    <label for="servicio">Servicio:</label>
                    <input type="text" id="servicio" placeholder="Servicio" required />
                </div>
                <div class="widget">
                    <label for="duracion">Duración:</label>
                    <input type="text" id="duracion" placeholder="Duración" required />
                </div>
                <div class="widget">
                    <label for="direccion">Dirección:</label>
                    <input type="text" id="direccion" placeholder="Dirección" required />
                </div>
                <div class="widget">
                    <label for="telefono">Número de Teléfono:</label>
                    <input type="tel" id="telefono" placeholder="Número de Teléfono" required pattern="[0-9]{10}" />
                </div>
                <div class="widget">
                    <label for="correo">Correo Electrónico:</label>
                    <input type="email" id="correo" placeholder="Correo Electrónico" />
                </div>

                <!-- Comprobante de Pago -->
                <div class="widget">
                    <label for="comprobante">Subir Comprobante de Pago:</label>
                    <input type="file" id="comprobante" accept="image/*,.pdf" required />
                </div>
                <div class="widget">
                    <label for="referencia">Número de Referencia de la Transacción:</label>
                    <input type="text" id="referencia" placeholder="Número de Referencia" required />
                </div>
                
            </div>

           
            <!-- Botón para Guardar o Agendar la Cita -->
            <div class="button-container">
                <button id="saveAppointment" class="zoom-button">Guardar Cita</button>
            </div>

            <!-- Información Adicional -->
            <div class="info-section">
                <h3>Instrucciones para la Cita</h3>
                <p>Por favor, asegúrate de unirte a la sala de Zoom al menos 5 minutos antes de la hora programada. Si
                    necesitas cancelar o reprogramar tu cita, hazlo con al menos 24 horas de antelación para evitar
                    cargos adicionales.</p>
                <p>Para reprogramar tu cita, <a href="contact.html">contáctanos aquí</a>.</p>
            </div>
        </div>
    </section>

    <!-- Pie de página -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2024 Dra. Corniel. Todos los derechos reservados.</p>
                <nav>
                    <ul>
                        <li><a href="privacy-policy.html">Política de Privacidad</a></li>
                        <li><a href="contact.html">Contacto</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    
        
    </footer>

    <!-- JavaScript para obtener y guardar datos en Airtable -->
    <script>
document.getElementById('saveAppointment').addEventListener('click', function () {
    const accessToken = 'patKNIDU8EKmRBvtm.06e6f81b87af643146f4d58cf259daedadf47302b073341aac28ce66eb641e38';
    const baseId = 'appCovpUwFjJlquFo';
    const tableName = 'Detalles de la cita';

    // Recoger los valores de los campos
    const nombre = document.getElementById('nombre').value;
    const fecha = document.getElementById('fecha').value;
    const servicio = document.getElementById('servicio').value;
    const duracion = document.getElementById('duracion').value;
    const direccion = document.getElementById('direccion').value;
    const telefono = document.getElementById('telefono').value;
    const correo = document.getElementById('correo').value;
    const referencia = document.getElementById('referencia').value; // Nuevo campo para la referencia

    // Validar el número de transferencia
    const isReferenciaValida = validarNumeroTransferencia(referencia);

    if (!nombre || !fecha || !servicio || !duracion || !direccion || !telefono || !isReferenciaValida) {
        alert('Por favor, complete todos los campos obligatorios y asegúrese de que el número de transferencia sea válido.');
        return;
    }

    // Verificar si ya existe un registro con el mismo número de referencia
    verificarDuplicado(referencia, accessToken, baseId, tableName)
    .then(duplicado => {
        if (duplicado) {
            alert('Este número de referencia ya ha sido utilizado. Por favor, ingrese un número de referencia único.');
        } else {
            // Crear objeto de datos para enviar a Airtable
            const data = {
                fields: {
                    Nombre: nombre,
                    Fecha: fecha,
                    Servicio: servicio,
                    Duracion: duracion,
                    Direccion: direccion,
                    Telefono: telefono,
                    Correo: correo,
                    Referencia: referencia, // Guardar la referencia en Airtable
                }
            };

            // Enviar los datos a Airtable
            enviarDatosAirtable(data, accessToken, baseId, tableName);
        }
    })
    .catch(error => {
        console.error('Error al verificar duplicado:', error);
        alert('Error al verificar el número de referencia. Intente nuevamente.');
    });
});

function validarNumeroTransferencia(referencia) {
    // Validar que el número tenga solo dígitos y tenga entre 10 y 15 dígitos (ajusta según tu necesidad)
    const regex = /^[0-9]{10,15}$/;
    return regex.test(referencia);
}

function verificarDuplicado(referencia, accessToken, baseId, tableName) {
    const url = `https://api.airtable.com/v0/${baseId}/${tableName}?filterByFormula={Referencia}="${referencia}"`;

    return fetch(url, {
        method: 'GET',
        headers: {
            Authorization: `Bearer ${accessToken}`
        }
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response.json();
    })
    .then(data => {
        return data.records.length > 0; // Devuelve true si ya existe un registro con la referencia
    });
}

function enviarDatosAirtable(data, accessToken, baseId, tableName) {
    const url = `https://api.airtable.com/v0/${baseId}/${tableName}`;

    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            Authorization: `Bearer ${accessToken}`
        },
        body: JSON.stringify(data)
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response.json();
    })
    .then(data => {
        alert('Cita guardada exitosamente, Una vez se lalide su pago, resivira un correo o un mensaje atravez del numero proporcionado, con su fecha seleccionada.');
    })
    .catch(error => {
        console.error('Error al guardar la cita en Airtable:', error);
        alert('Error al guardar la cita: ' + error.message);
    });
}

   </script>
</body>

</html>
